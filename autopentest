from subprocess import PIPE, run
#import tldextract
import os
import time
#extract domain name
#addr = input("Enter Web App URL : ")
#addr = tldextract.extract(addr)
#addr = "{}.{}".format(addr.domain,addr.suffix)
#print(addr)
#Run kinux command function
def out(command):
    result = run(command, stdout=PIPE, stderr=PIPE, universal_newlines=True, shell=True)
#    print(result.stdout,result.returncode)
    return result.stdout

#nmap
fullPort = out("nmap -A -sV -iL dnsNoDup.txt -oG output.grep") #removed -p- arg for faster testing
if os.path.exists("portList.txt"):
  os.remove("portList.txt")
out("./porttest.sh")

count = 0
ip = ""
webaddr = ""
for line in open("portList.txt", "r"):
    if line != "END\n":
        if count == 0 :
            ip = line.rstrip()
            count = count+1
        else:
            add = ip+":"+line
            webaddr = webaddr+ add
    else:
        count = 0
outfile = open("portList.txt", "w")
outfile.write(webaddr)
outfile.close()

#Loop dirsearch
#outfile = open("direct.txt", "w")
for line in open("dnsNoDup.txt", "r"):
    m = out("dirsearch --exclude-status 403,401 -u http://"+line + "-o dirsearch.txt")
#    outfile.write(m)
#outfile.close()
#print("finish portscan")
#XSSSniper
for line in open("dnsNoDup.txt", "r"):
	xss = out("python xsssniper.py -u "+line+" --crawl --forms")